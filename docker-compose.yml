version: "3.8"

services:
  app:
    build: .
    image: cx-invest:latest
    container_name: cx-invest-app
    ports:
      - "8080:8080"
    volumes:
      - ./data:/data
    environment:
      QUARKUS_DATASOURCE_JDBC_URL: "jdbc:sqlite:/data/cx-invest.db"
      QUARKUS_HIBERNATE_ORM_DATABASE_GENERATION: "drop-and-create"
      QUARKUS_OIDC_AUTH_SERVER_URL: "http://host.docker.internal:8180/realms/cx-invest"
      QUARKUS_OIDC_CLIENT_ID: "cx-invest-backend"
      QUARKUS_OIDC_CREDENTIALS_SECRET: "secret"
      QUARKUS_OTEL_ENABLED: "false"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:8080/q/health", "||", "exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10

